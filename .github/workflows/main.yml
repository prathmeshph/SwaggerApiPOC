name: Download Swagger Files üöÄ

on:
  workflow_dispatch:  # Manual trigger (can add push/pr/schedule if needed)

jobs:
  download-swagger:
    runs-on: ubuntu-latest

    env:
      BASE_URL: apigateways-z10-<ENV>.amla.io
      APPS: |
        customapi
        customtable
        znodeengineapiv2
        cpapi
        paymentmanager
        shippingmanager
        ReportsApi
      ENVIRONMENTS: |
        QA
        Sandbox

    steps:
      - name: üèóÔ∏è Set up directory structure
        run: |
          mkdir -p project
          for ENV in $ENVIRONMENTS; do
            mkdir -p project/$ENV
          done

      - name: üì• Download Swagger files dynamically
        run: |
          for ENV in $ENVIRONMENTS; do
            # convert to lowercase for the subdomain part of the URL
            ENV_LOWER=$(echo "$ENV" | tr '[:upper:]' '[:lower:]')
            for APP in $APPS; do
              echo "Downloading $APP Swagger for $ENV environment..."
              curl -s -o project/$ENV/${APP}.json https://apigateways-z10-${ENV_LOWER}.amla.io/swagger/${APP}/swagger.json
            done
          done
          
      - name: üìÇ Show downloaded Swagger files environment-wise
        run: |
          echo "‚úÖ Swagger files downloaded in the following structure:"
          for ENV in $ENVIRONMENTS; do
            echo ""
            echo "üîπ Environment: $ENV"
            ls -1 project/$ENV || echo "‚ö†Ô∏è No files found in project/$ENV"
          done

        
