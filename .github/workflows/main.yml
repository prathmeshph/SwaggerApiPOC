name: Download Swagger Files ğŸš€

on:
  workflow_dispatch:  # Manual trigger (can add push/pr/schedule if needed)

jobs:
  download-swagger:
    runs-on: ubuntu-latest

    env:
      BASE_URL: apigateways-z10-<ENV>.amla.io
      APPS: |
        customapi
        customtable
        znodeengineapiv2
        cpapi
        paymentmanager
        shippingmanager
        ReportsApi
      ENVIRONMENTS: |
        QA
        Sandbox

    steps:
      - name: ğŸ—ï¸ Set up directory structure
        run: |
          mkdir -p project
          for ENV in $ENVIRONMENTS; do
            mkdir -p project/$ENV
          done

      - name: ğŸ“¥ Download Swagger files dynamically
        run: |
          for ENV in $ENVIRONMENTS; do
            # convert to lowercase for the subdomain part of the URL
            ENV_LOWER=$(echo "$ENV" | tr '[:upper:]' '[:lower:]')
            for APP in $APPS; do
              echo "Downloading $APP Swagger for $ENV environment..."
              curl -s -o project/$ENV/${APP}.json https://apigateways-z10-${ENV_LOWER}.amla.io/swagger/${APP}/swagger.json
            done
          done
          
      - name: ğŸ“‚ Show downloaded Swagger files environment-wise
        run: |
          echo "âœ… Swagger files downloaded in the following structure:"
          for ENV in $ENVIRONMENTS; do
            echo ""
            echo "ğŸ”¹ Environment: $ENV"
            ls -1 project/$ENV || echo "âš ï¸ No files found in project/$ENV"
          done

      - name: ğŸ§ª Debug Info - Show Working Directory and File Structure
        run: |
          echo "ğŸ“Œ Current working directory:"
          pwd
          
          echo ""
          echo "ğŸ“„ Detailed file structure:"
          ls -lR  # Recursive list, shows everything in all folders
          cat /project/QA/ReportsApi.json



        
